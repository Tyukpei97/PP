<Window x:Class="GraphExec.UI.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:GraphExec.UI"
        mc:Ignorable="d"
        Title="Reactive Graph"
        Height="720" Width="1200"
        Background="#0E1014">
    <Window.Resources>
        <SolidColorBrush x:Key="PanelBrush" Color="#181C24"/>
        <SolidColorBrush x:Key="CardBrush" Color="#1f2633"/>
        <SolidColorBrush x:Key="AccentBrush" Color="#4FC3F7"/>
        <local:StringToVisibilityConverter x:Key="StringToVisibilityConverter"/>
        <local:EditorModeToVisibilityConverter x:Key="EditorModeToVisibilityConverter"/>
        <local:TextEditorVisibilityConverter x:Key="TextEditorVisibilityConverter"/>
        <local:SliderEditorVisibilityConverter x:Key="SliderEditorVisibilityConverter"/>
        <Style x:Key="PortButton" TargetType="Button">
            <Setter Property="Width" Value="18"/>
            <Setter Property="Height" Value="18"/>
            <Setter Property="Margin" Value="4"/>
            <Setter Property="Background" Value="#2E3340"/>
            <Setter Property="BorderBrush" Value="#4FC3F7"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="HorizontalAlignment" Value="Center"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="ToolTip" Value="{Binding Type.DisplayName}"/>
        </Style>
        <Style x:Key="NodeCard" TargetType="Border">
            <Setter Property="CornerRadius" Value="10"/>
            <Setter Property="BorderBrush" Value="#2E3542"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Background" Value="{StaticResource CardBrush}"/>
            <Setter Property="Padding" Value="8"/>
        </Style>
    </Window.Resources>
    <DockPanel>
        <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Background="#151820" Margin="0" >
            <Button x:Name="NewButton" Content="NEW" Width="90" Margin="0,0,6,0" Click="New_Click"/>
            <Button x:Name="DemoButton" Content="DEMO" Width="90" Margin="0,0,6,0" Click="Demo_Click"/>
            <Button x:Name="SaveButton" Content="SAVE" Width="110" Margin="0,0,6,0" Click="Save_Click"/>
            <Button x:Name="LoadButton" Content="LOAD" Width="110" Margin="0,0,6,0" Click="Load_Click"/>
            <Button x:Name="AutoButton" Content="AUTO" Width="150" Margin="0,0,6,0" Click="Auto_Click"/>
            <Button x:Name="MacroButton" Content="MACRO" Width="150" Margin="0,0,6,0" Click="Macro_Click"/>
            <TextBlock x:Name="HintText" Text="STATUS" Foreground="#B0C4FF" VerticalAlignment="Center" Margin="10,0,0,0"/>
        </StackPanel>
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="260"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <Border Grid.Column="0" Background="{StaticResource PanelBrush}" Padding="10" BorderBrush="#1F2430" BorderThickness="0,0,1,0">
                <StackPanel>
                    <TextBlock x:Name="PaletteHeader" Text="Palette" Foreground="White" FontWeight="Bold" FontSize="16" Margin="0,0,0,10"/>
                    <ListBox x:Name="PaletteList"
                             ItemsSource="{Binding Palette}"
                             Background="#202734"
                             BorderThickness="0"
                             Foreground="White"
                             SelectionMode="Single"
                             PreviewMouseMove="PaletteList_PreviewMouseMove">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <Border Padding="8" Margin="0,0,0,6" CornerRadius="6" Background="#252C3B">
                                    <StackPanel>
                                        <TextBlock Text="{Binding DisplayName}" FontWeight="Bold"/>
                                        <TextBlock Text="{Binding Category}" FontSize="11" Foreground="#8BA3C4"/>
                                    </StackPanel>
                                </Border>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </StackPanel>
            </Border>
            <Grid Grid.Column="1" Background="#0E1014">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="30"/>
                </Grid.RowDefinitions>
                <Border Grid.Row="0" Margin="6" Background="#11151c" CornerRadius="8" BorderBrush="#1E2632" BorderThickness="1">
                    <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto">
                        <Canvas x:Name="EditorCanvas"
                                Background="#0f131a"
                                Height="1800" Width="2600"
                                AllowDrop="True"
                                Drop="EditorCanvas_Drop"
                                MouseWheel="EditorCanvas_MouseWheel"
                                MouseDown="EditorCanvas_MouseDown"
                                MouseMove="EditorCanvas_MouseMove"
                                MouseUp="EditorCanvas_MouseUp">
                            <Canvas.RenderTransform>
                                <TransformGroup>
                                    <ScaleTransform x:Name="ZoomTransform" ScaleX="1" ScaleY="1"/>
                                    <TranslateTransform x:Name="PanTransform" X="0" Y="0"/>
                                </TransformGroup>
                            </Canvas.RenderTransform>
                            <ItemsControl ItemsSource="{Binding Connections}">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <Canvas/>
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Path Data="{Binding PathData}"
                                              Stroke="{StaticResource AccentBrush}"
                                              StrokeThickness="2"
                                              StrokeDashArray="2 6">
                                            <Path.Triggers>
                                                <EventTrigger RoutedEvent="Loaded">
                                                    <BeginStoryboard>
                                                        <Storyboard RepeatBehavior="Forever">
                                                            <DoubleAnimation Storyboard.TargetProperty="StrokeDashOffset"
                                                                             From="0" To="-20" Duration="0:0:1.6"
                                                                             AutoReverse="False"/>
                                                        </Storyboard>
                                                    </BeginStoryboard>
                                                </EventTrigger>
                                            </Path.Triggers>
                                        </Path>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                            <ItemsControl ItemsSource="{Binding Nodes}">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <Canvas/>
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemContainerStyle>
                                    <Style TargetType="ContentPresenter">
                                        <Setter Property="Canvas.Left" Value="{Binding X}"/>
                                        <Setter Property="Canvas.Top" Value="{Binding Y}"/>
                                    </Style>
                                </ItemsControl.ItemContainerStyle>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Width="{Binding Width}"
                                                Height="{Binding Height}"
                                                MouseLeftButtonDown="Node_MouseLeftButtonDown"
                                                MouseMove="Node_MouseMove"
                                                MouseLeftButtonUp="Node_MouseLeftButtonUp">
                                            <Border.Style>
                                                <Style TargetType="Border" BasedOn="{StaticResource NodeCard}">
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding IsSelected}" Value="True">
                                                            <Setter Property="BorderBrush" Value="#6AD1FF"/>
                                                            <Setter Property="BorderThickness" Value="2"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Border.Style>
                                            <Grid>
                                                <Grid.RowDefinitions>
                                                    <RowDefinition Height="32"/>
                                                    <RowDefinition Height="*"/>
                                                    <RowDefinition Height="Auto"/>
                                                </Grid.RowDefinitions>
                                                <DockPanel Grid.Row="0">
                                                    <TextBlock Text="{Binding Definition.DisplayName}" FontWeight="Bold" Foreground="White"/>
                                                    <Border Background="#2A3141" CornerRadius="4" Padding="4" HorizontalAlignment="Right">
                                                        <TextBlock Text="{Binding ValueText}" Foreground="#A8D1FF"/>
                                                    </Border>
                                                </DockPanel>
                                                <Grid Grid.Row="1" Margin="0,4,0,0">
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="28"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="28"/>
                                                    </Grid.ColumnDefinitions>
                                                    <StackPanel Grid.Column="0">
                                                        <ItemsControl ItemsSource="{Binding Inputs}">
                                                            <ItemsControl.ItemTemplate>
                                                                <DataTemplate>
                                                                    <Button Style="{StaticResource PortButton}"
                                                                            ToolTip="{Binding Type.DisplayName}"
                                                                            Tag="{Binding}"
                                                                            Click="InputPort_Click"/>
                                                                </DataTemplate>
                                                            </ItemsControl.ItemTemplate>
                                                        </ItemsControl>
                                                    </StackPanel>
                                                    <StackPanel Grid.Column="1">
                                                        <ItemsControl ItemsSource="{Binding Inputs}">
                                                            <ItemsControl.ItemTemplate>
                                                                <DataTemplate>
                                                                    <StackPanel>
                                                                        <TextBlock Text="{Binding Name}" Foreground="#9FB3D6" />
                                                                        <TextBlock Text="{Binding Type.DisplayName}" Foreground="#657391" FontSize="10"/>
                                                                    </StackPanel>
                                                                </DataTemplate>
                                                            </ItemsControl.ItemTemplate>
                                                        </ItemsControl>
                                                    </StackPanel>
                                                    <StackPanel Grid.Column="2">
                                                        <ItemsControl ItemsSource="{Binding Outputs}">
                                                            <ItemsControl.ItemTemplate>
                                                                <DataTemplate>
                                                                    <StackPanel>
                                                                        <TextBlock Text="{Binding Name}" Foreground="#9FB3D6" HorizontalAlignment="Right"/>
                                                                        <TextBlock Text="{Binding Type.DisplayName}" Foreground="#657391" FontSize="10" HorizontalAlignment="Right"/>
                                                                    </StackPanel>
                                                                </DataTemplate>
                                                            </ItemsControl.ItemTemplate>
                                                        </ItemsControl>
                                                    </StackPanel>
                                                    <StackPanel Grid.Column="3">
                                                        <ItemsControl ItemsSource="{Binding Outputs}">
                                                            <ItemsControl.ItemTemplate>
                                                                <DataTemplate>
                                                                    <Button Style="{StaticResource PortButton}"
                                                                            ToolTip="{Binding Type.DisplayName}"
                                                                            Tag="{Binding}"
                                                                            Click="OutputPort_Click"/>
                                                                </DataTemplate>
                                                            </ItemsControl.ItemTemplate>
                                                        </ItemsControl>
                                                    </StackPanel>
                                                </Grid>
                                                <StackPanel Grid.Row="2" Margin="0,6,0,0">
                                                    <TextBlock Text="{Binding ErrorText}" Foreground="#FF7F7F" Visibility="{Binding ErrorText, Converter={StaticResource StringToVisibilityConverter}}" />
                                                    <Border Background="#20283A" Padding="4" CornerRadius="4" Visibility="{Binding Badge, Converter={StaticResource StringToVisibilityConverter}}">
                                                        <TextBlock Text="{Binding Badge}" Foreground="#8BD7FF"/>
                                                    </Border>
                                                    <StackPanel Orientation="Horizontal" Margin="0,4,0,0" Visibility="{Binding Mode, Converter={StaticResource EditorModeToVisibilityConverter}}">
                                                        <TextBlock Text="Источник:" Foreground="#98A9C7" Margin="0,0,6,0"/>
                                                        <TextBox Width="120" Text="{Binding TextValue, UpdateSourceTrigger=PropertyChanged}" Visibility="{Binding Mode, Converter={StaticResource TextEditorVisibilityConverter}}"/>
                                                        <Slider Width="140" Minimum="-100" Maximum="100" Value="{Binding SliderValue, UpdateSourceTrigger=PropertyChanged}" Visibility="{Binding Mode, Converter={StaticResource SliderEditorVisibilityConverter}}"/>
                                                    </StackPanel>
                                                </StackPanel>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </Canvas>
                    </ScrollViewer>
                </Border>
                <Border Grid.Row="1" Background="#151820" Padding="8">
                    <TextBlock Text="{Binding Status}" Foreground="#9DB7D8"/>
                </Border>
            </Grid>
        </Grid>
    </DockPanel>
</Window>
